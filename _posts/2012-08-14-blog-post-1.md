---
title: 'Classifing grayscale images of handwritten digits (MNIST) using Keras '
date: 2018-04-09
permalink: /posts/2018/04/mnist_keras/
tags:
  - Neural Network
  - Deep Learning
  - MNIST
  - Keras
---

## Classifing grayscale images of handwritten digits (MNIST) using Keras 

In this post I will solve the classification problem of grayscale images of handwritten digits. This data set, also called MNIST, is classic. It contains 10 categories of handwritten digits (28x28 pixels) and the goal is to classify them into their 10 categories, which are 0 to 9. The set contains 60K traning images (which we will further separate to train and dev sets) plus 10K test images. The data were gathered by the [National Institute of Standards and Technology](https://www.nist.gov/) in the 1980s. To the deep learning community solving the MNIST problem is like printing "Hello World" as is costum for any computer science major.

```
<pre>
python
</pre>
```

The MNIST dataset comes pre-loaded in Keras, in the form of a set of four Numpy arrays:


```
python
import keras
keras.__version__
```

    Using TensorFlow backend.





    '2.0.2'




```python
from keras.datasets import mnist
(train_images, train_labels), (test_images, test_labels) = mnist.load_data('/home/f643954/datasets/mnist.npz')
```


```python
train_images.shape
```




    (60000, 28, 28)




```python
test_images.shape
```




    (10000, 28, 28)




```python
from keras import models
from keras import layers
model = models.Sequential()
model.add(layers.Dense(512, activation='relu', input_shape=(28 * 28,)))
model.add(layers.Dropout(0.5))
model.add(layers.Dense(10, activation='softmax'))
```


```python
model.compile(optimizer='adam',
                loss='categorical_crossentropy',
                metrics=['accuracy'])
```


```python
train_images = train_images.reshape((60000, 28 * 28))
train_images = train_images.astype('float32') / 255

test_images = test_images.reshape((10000, 28 * 28))
test_images = test_images.astype('float32') / 255
```


```python
from keras.utils import to_categorical

train_labels = to_categorical(train_labels)
test_labels = to_categorical(test_labels)
```


```python
val_train_images = train_images[:10000,:]
partial_train_images = train_images[10000:,:]

val_train_labels = train_labels[:10000,:]
partial_train_labels = train_labels[10000:,:]
```


```python
history = model.fit(partial_train_images, 
                    partial_train_labels, 
                    epochs=20, 
                    batch_size=128, 
                    validation_data=(val_train_images, val_train_labels))
```

    Train on 50000 samples, validate on 10000 samples
    Epoch 1/20
    50000/50000 [==============================] - 6s - loss: 0.3653 - acc: 0.8920 - val_loss: 0.1750 - val_acc: 0.9498
    Epoch 2/20
    50000/50000 [==============================] - 6s - loss: 0.1714 - acc: 0.9503 - val_loss: 0.1258 - val_acc: 0.9630
    Epoch 3/20
    50000/50000 [==============================] - 6s - loss: 0.1276 - acc: 0.9625 - val_loss: 0.1026 - val_acc: 0.9702
    Epoch 4/20
    50000/50000 [==============================] - 6s - loss: 0.1049 - acc: 0.9682 - val_loss: 0.0879 - val_acc: 0.9739
    Epoch 5/20
    50000/50000 [==============================] - 6s - loss: 0.0861 - acc: 0.9735 - val_loss: 0.0802 - val_acc: 0.9767
    Epoch 6/20
    50000/50000 [==============================] - 6s - loss: 0.0773 - acc: 0.9755 - val_loss: 0.0741 - val_acc: 0.9777
    Epoch 7/20
    50000/50000 [==============================] - 6s - loss: 0.0670 - acc: 0.9788 - val_loss: 0.0687 - val_acc: 0.9794
    Epoch 8/20
    50000/50000 [==============================] - 6s - loss: 0.0629 - acc: 0.9796 - val_loss: 0.0666 - val_acc: 0.9805
    Epoch 9/20
    50000/50000 [==============================] - 6s - loss: 0.0567 - acc: 0.9818 - val_loss: 0.0664 - val_acc: 0.9816
    Epoch 10/20
    50000/50000 [==============================] - 6s - loss: 0.0501 - acc: 0.9836 - val_loss: 0.0658 - val_acc: 0.9810
    Epoch 11/20
    50000/50000 [==============================] - 6s - loss: 0.0441 - acc: 0.9858 - val_loss: 0.0617 - val_acc: 0.9821
    Epoch 12/20
    50000/50000 [==============================] - 6s - loss: 0.0414 - acc: 0.9864 - val_loss: 0.0634 - val_acc: 0.9822
    Epoch 13/20
    50000/50000 [==============================] - 6s - loss: 0.0389 - acc: 0.9872 - val_loss: 0.0623 - val_acc: 0.9830
    Epoch 14/20
    50000/50000 [==============================] - 6s - loss: 0.0371 - acc: 0.9876 - val_loss: 0.0617 - val_acc: 0.9823
    Epoch 15/20
    50000/50000 [==============================] - 6s - loss: 0.0361 - acc: 0.9876 - val_loss: 0.0678 - val_acc: 0.9819
    Epoch 16/20
    50000/50000 [==============================] - 6s - loss: 0.0323 - acc: 0.9892 - val_loss: 0.0601 - val_acc: 0.9827
    Epoch 17/20
    50000/50000 [==============================] - 6s - loss: 0.0324 - acc: 0.9886 - val_loss: 0.0653 - val_acc: 0.9815
    Epoch 18/20
    50000/50000 [==============================] - 5s - loss: 0.0282 - acc: 0.9907 - val_loss: 0.0635 - val_acc: 0.9839
    Epoch 19/20
    50000/50000 [==============================] - 6s - loss: 0.0293 - acc: 0.9904 - val_loss: 0.0624 - val_acc: 0.9824
    Epoch 20/20
    50000/50000 [==============================] - 6s - loss: 0.0255 - acc: 0.9914 - val_loss: 0.0632 - val_acc: 0.9840



```python
history_dict = history.history
history_dict.keys()
```




    dict_keys(['val_loss', 'val_acc', 'loss', 'acc'])




```python
test_loss, test_acc = model.evaluate(test_images, test_labels)
```

     9472/10000 [===========================>..] - ETA: 0s


```python
print('test_acc:', test_acc)
#test_acc: 0.9812
```

    test_acc: 0.983



```python
import matplotlib.pyplot as plt

plt.figure(figsize=(20,10))

plt.subplot(121)
loss_values = history_dict['loss']
val_loss_values = history_dict['val_loss']
epochs = range(1, len(loss_values) + 1)
plt.plot(epochs, loss_values, 'bo', label='Training loss')
plt.plot(epochs, val_loss_values, 'b', label='Validation loss')
plt.title('Training and validation loss',fontsize=20)
plt.xlabel('Epochs',fontsize=20)
plt.ylabel('Loss',fontsize=20)
plt.legend(fontsize=20)
plt.xticks(fontsize=20)
plt.yticks(fontsize=20)


plt.subplot(122)
acc_values = history_dict['acc']
val_acc_values = history_dict['val_acc']
epochs = range(1, len(loss_values) + 1)
plt.plot(epochs, acc_values, 'bo', label='Training acc')
plt.plot(epochs, val_acc_values, 'b', label='Validation acc')
plt.title('Training and validation accuracy',fontsize=20)
plt.xlabel('Epochs',fontsize=20)
plt.ylabel('Loss',fontsize=20)
plt.legend(fontsize=20)
plt.xticks(fontsize=20)
plt.yticks(fontsize=20)
plt.show()
```


![png](output_13_0.png)



```python

```

